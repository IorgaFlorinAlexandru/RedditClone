<div class="relative h-10">
    <div *ngIf="userCommunities$ | async as userCommunities" #communitySelectMenu class="text-[#818384] bg-[#1a1a1b] rounded absolute z-10
        border border-[#343536] w-80 text-sm font-semibold">
        <div (click)="openSelectMenu()" class="border-[#343536] w-full cursor-pointer flex items-center h-10  pr-2 pl-2"
            [ngClass]="{'border-b ': showSelectMenu}">
            <ng-container *ngIf="!showSelectMenu,else searchCommunities">
                <ng-container *ngIf="selectedCommunity, else chooseCommunity">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" class=" h-6 w-6 fill-[#0079d3] 
                    bg-white rounded-full border-2 inline-block">
                        <path d="M16.5,2.924,11.264,15.551H9.91L15.461,2.139h.074a9.721,9.721,0,1,0,.967.785ZM8.475,8.435a1.635,1.635,0,0,0-.233.868v4.2H6.629V6.2H8.174v.93h.041a2.927,2.927,0,0,1,1.008-.745,3.384,3.384,0,0,1,1.453-.294,3.244,3.244,0,0,1,.7.068,1.931,1.931,0,0,1,.458.151l-.656,1.558a2.174,2.174,0,0,0-1.067-.246,2.159,2.159,0,0,0-.981.215A1.59,1.59,0,0,0,8.475,8.435Z"></path>
                    </svg>
                    <div class="inline-block align-middle ml-2">
                        <h2 class="text-sm text-[#d7dadc]">r/{{selectedCommunity.name}}</h2>
                    </div>
                </ng-container>
            </ng-container>
        </div>
        <div *ngIf="showSelectMenu" class="select-menu overflow-y-scroll scrollbar-dark p-2">
            <div class="w-full font-bold">
                <h2 class="uppercase text-[10px] inline-block">Your Communities</h2>
                <button class="inline float-right text-[#d7dadc] hover:bg-[#272729] pl-2 pr-2">Create new</button>
            </div>
            <ng-container *ngIf="userCommunities.status !== LOADING_STATUS, else loading">
                <ul class="mt-4">
                    <li *ngFor="let community of userCommunities.data" (click)="selectCommunity(community)" class="cursor-pointer mt-2">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" class=" h-8 w-8 fill-[#0079d3] 
                        bg-white rounded-full border-2 inline-block">
                            <path d="M16.5,2.924,11.264,15.551H9.91L15.461,2.139h.074a9.721,9.721,0,1,0,.967.785ZM8.475,8.435a1.635,1.635,0,0,0-.233.868v4.2H6.629V6.2H8.174v.93h.041a2.927,2.927,0,0,1,1.008-.745,3.384,3.384,0,0,1,1.453-.294,3.244,3.244,0,0,1,.7.068,1.931,1.931,0,0,1,.458.151l-.656,1.558a2.174,2.174,0,0,0-1.067-.246,2.159,2.159,0,0,0-.981.215A1.59,1.59,0,0,0,8.475,8.435Z"></path>
                        </svg>
                        <div class="inline-block align-middle ml-2">
                            <h2 class="text-sm text-[#d7dadc]">r/{{community.name}}</h2>
                            <span class="text-[12px]">1 member</span>
                        </div>
                    </li>
                </ul>
            </ng-container>
        </div>
    </div>
</div>

<ng-template #searchCommunities>
    <app-icon>search</app-icon>
    <form class="w-full" [formGroup]="searchForm">
        <input formControlName="searchField" class="ml-2 w-full bg-transparent focus:outline-none text-white 
        placeholder:text-[#818384]" placeholder="Search Communities"/>
    </form>
</ng-template>

<ng-template #chooseCommunity>
    <app-icon>viewfinder-circle</app-icon>
    <span class="ml-2 flex-1">Choose a community</span>
    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-4 h-4">
        <path stroke-linecap="round" stroke-linejoin="round" d="M19.5 8.25l-7.5 7.5-7.5-7.5" />
    </svg>
</ng-template>

<ng-template #loading>
    <div class="w-full p-2">
        <div class="w-112 mt-2">
            <div class="loader ml-auto mr-auto"></div>
        </div>
    </div>
</ng-template>